let mapdata=[
  {
    "stop": "Canal Street",
    "features": [
      {
        "location": "Canal Street",
        "soundaddress":"assets/Canal street/CanalSt1.mp3",
        "description": "Canal St-Chinese New Year Festivities: Stepping into Manhattan’s Chinatown is like being immersed in another country. During January or February, you can hear people celebrating lunar new year. A common festivity during this time is lighting firecrackers, which  were originally used to scare away evil spirits. You can hear children playing with bang snaps, a small firecracker that emitts a crisp sound when thrown on the ground.",
        "pictures": "https://raw.githubusercontent.com/ZhijunSong/MuseumofSound/main/assets/Canal%20street/CanalSt2.jpg"
      },
      {
        "location": "Canal street : supermarket",
        "soundaddress": "assets/Canal street/CanalSt2.mp3",
        "description": "Canal St-Chinatown Supermarket: There are many supermarkets in Chinatown where you can find authentic Asian food and ingredients. The supermarket transports shopper to the 1990s with this classic Cantonese song. The vintage decorations along with the tunes tell us a story from the last century.",
        "pictures": "https://raw.githubusercontent.com/ZhijunSong/MuseumofSound/main/assets/Canal%20street/CanalSt4.jpg"
      },
      {
        "location": "Canal street : supermarket",
        "soundaddress": "assets/Canal street/CanalSt3.mp3",
        "description": "Canal St- Chinatown Restaurant: On a weekend morning, restaurants in Chinatown are bustling with diners. Here, you can hear the sound of people ordering food in Cantonese, a language characteristic of Chinatown. Historically, Cantonese speakers dominated the western side of Chinatown, an area that continues to be a main business district. This language represents the history of Chinese immigration.",
        "pictures": "https://raw.githubusercontent.com/ZhijunSong/MuseumofSound/main/assets/Canal%20street/CanalSt3.jpg"
      },
      {
        "location": "Canal street",
        "soundaddress": "/Canal street/CanalSt1.mp3",
        "description": "Canal St-Chinatown Er Hu Player: The erhu is a two-stringed bowed musical instrument and is known in the West as the Chinese violin. It can be a solo instrument or played in small emsembles or large orchestras.  Unlike street performers playing western instruments in Time square or Union square, elderly performers in Chinatown bring Chinese traditional sounds to this diverse city.",
        "pictures": "https://raw.githubusercontent.com/ZhijunSong/MuseumofSound/main/assets/Canal%20street/CanalSt1.jpg"
      },
      {
        "location": "Canal street",
        "soundaddress": "assets/Canal street/CanalSt5.mp3",
        "description": "Canal St-Chinatown Antique Store: This store is located in Chinatown and sells Chinese trinkets and souvenirs. In this clip, you can hear the bells from a wind chime, a sound commonly heard in this area.",
        "pictures": "https://raw.githubusercontent.com/ZhijunSong/MuseumofSound/main/assets/Canal%20street/CanalSt5.jpg"
      }
    ]
  },
  {
    "stop": "Union Square",
    "features": [
      {
        "location": "Union Square",
        "soundaddress": "https://github.com/ZhijunSong/MuseumofSound/blob/main/assets/14th%20street/14th%20St.%2002.mp3?raw=true",
        "description": "Union Square-Chess Game:Union Square is a big chess hub and it’s located just outside the subway entrance near the northeast corner of 14th St. and Union Square West. Dozens of chess players sit on crates and use makeshift tables. They lure passersby with offers to try to beat them for $5 to $10 per game. Some players make a living from playing chess in this area. It is a way of relaxation in the New York City.",
        "pictures": "https://raw.githubusercontent.com/ZhijunSong/MuseumofSound/main/assets/14th%20street/14thSt2.jpg"
      },
      {
        "location": "Union Square",
        "soundaddress": "https://github.com/ZhijunSong/MuseumofSound/blob/main/assets/14th%20street/14th%20St%2001.mp3?raw=true",
        "description": "Union Square-Farmers Market: \n\nFarmer market is an essential elements for any city, a tradition as old as civilization itself. Union Square Greenmarket began with just a few farmers in 1976 and has grown exponentially. In peak season, 140 regional farmers, fishers, and bakers sell their products to a dedicated legion of city dwellers. It’s open Monday, Wednesday, Friday, and Saturday and you can find up to 60,000 shoppers wandering around the market. You can hear the sound of shoppers chatting with vendor in this clip.",
        "pictures": "https://raw.githubusercontent.com/ZhijunSong/MuseumofSound/main/assets/14th%20street/14thSt1.jpg"
      },
      {
        "location": "Union square",
        "soundaddress": "https://github.com/ZhijunSong/MuseumofSound/blob/main/assets/14th%20street/14th%20St.%2003mp3?raw=true",
        "description": "The Metropolitan Transportation Authority (MTA) grants every musician the legal right to perform so you can find many of them inside subway stations.  In 2020, music in the subway disappeared because of the city lockdown. The MTA restarted its Music Under New York program, which organize some 350 performers at some of the most popular underground spots. It gives people the feeling that New York is returning to normal. Performance in the subway represents the street culture of New York City.",
        "pictures": "https://raw.githubusercontent.com/ZhijunSong/MuseumofSound/main/assets/14th%20street/14thSt3.jpg"
      }
    ]
  },
  {
    "stop": "34 St - Herald Square",
    "features": [
      {
        "location": "34th Street : Greeley square",
        "soundaddress": "https://github.com/ZhijunSong/MuseumofSound/blob/main/assets/Ktown/34th%20st%2002.mp3?raw=true",
        "description": "Greeley square park:\n\nGreeley square park is a triangular space that lies between West 32nd Street and West 33rd street in Midtown Manhattan. It serves as a rest area for the thousands of shoppers, a lunchroom for people who work in midtown, and a stage for musical performances. There are two tables for people to play ping pong. In this area, you can often hear fire truck and police car sirens.",
        "pictures": "https://raw.githubusercontent.com/ZhijunSong/MuseumofSound/main/assets/Ktown/34thSt2.jpg"
      },
      {
        "location": "Ktown food court",
        "soundaddress": "https://github.com/ZhijunSong/MuseumofSound/blob/main/assets/Ktown/34th%20St.01.m4a?raw=true",
        "description": "Korean town Food court:\n\nThere are high density of crowded restaurants, bars, and karaoke clubs in Koreatown. It is a major tourist attraction and the center of nightlife in Manhattan. This clip is from a food court in Koreatown and you can hear diners talking, Korean music playing",
        "pictures": "https://raw.githubusercontent.com/ZhijunSong/MuseumofSound/main/assets/Ktown/34thSt1.jpg"
      }
    ]
  },
  {
    "stop": "Times Sq - 42 St",
    "features": [
      {
        "location": "Time Square",
        "soundaddress": "https://github.com/ZhijunSong/MuseumofSound/blob/main/assets/Time%20Square/42nd%20St.%2001mp3?raw=true",
        "description": "Time Square:\n\nTimes Square is one of the world's most visited tourist attractions, drawing an estimated 50 million visitors annually. Approximately 330,000 people pass through Times Square daily and you can hear various languages being spoken.",
        "pictures": "https://raw.githubusercontent.com/ZhijunSong/MuseumofSound/main/assets/Time%20Square/42ndSt1.jpg"
      },
      {
        "location": "Time Square",
        "soundaddress": "https://github.com/ZhijunSong/MuseumofSound/blob/main/assets/Time%20Square/42nd%20St.%2002.mp3?raw=true",
        "description": "Street announcer in Time squareTime square is a famous tourist destination and has a lot of street announcers selling to tourists passing by. The sound comes from a street announcer selling discount tickets in Time Square.",
        "pictures": "https://raw.githubusercontent.com/ZhijunSong/MuseumofSound/main/assets/Time%20Square/42ndSt2.jpg"
      },
      {
        "location": "Time Square",
        "soundaddress": "https://github.com/ZhijunSong/MuseumofSound/blob/main/assets/Time%20Square/42nd%20St%2003.m4a?raw=true",
        "description": "Street performer in time square subway: Times Square is a popular destination for busking due to the large flow of people passing through. The Metropolitan Transportation Authority (MTA)  grants every musician the legal right to perform. In 2020, music in the subway disappeared because of the city lockdown. MTA restarted its Music Under New York program, which organizes some 350 other performers at some of the most popular underground spots, to give people the feeling that New York is returning to normal. You can hear a slice of iconic New York street culture in this clip.",
        "pictures": "https://raw.githubusercontent.com/ZhijunSong/MuseumofSound/main/assets/Time%20Square/42ndSt3.jpg"
      }
    ]
  }
]
//viz sound
var mic, soundFile;
var amplitude;

var prevLevels = new Array(60);



let sound=[];
let img=[];
let nodeX;
let nodeY;
let buttons=[];
let cnv;
let indexID =0;
function preload(){
  sound[0] =loadSound("assets/Canalstreet/CanalSt1.mp3",loaded);

  sound[1] =loadSound("assets/Canalstreet/CanalSt2.mp3",loaded);
  sound[2] =loadSound("assets/Canalstreet/CanalSt3.mp3",loaded);
  sound[3] =loadSound("assets/Canalstreet/CanalSt4.mp3",loaded);
  sound[4] =loadSound("assets/Canalstreet/CanalSt5.mp3",loaded);



  // songs[0] = loadSound("https://github.com/ZhijunSong/MuseumofSound/blob/main/assets/Canal%20street/Canal%20St.01m4a?raw=true",loaded);
  // songs[1] = loadSound('https://github.com/ZhijunSong/MuseumofSound/blob/main/assets/Canal%20street/Canal%20St.01m4a?raw=true',loaded);
  // songs[2] = loadSound('https://github.com/ZhijunSong/MuseumofSound/blob/main/assets/Canal%20street/Canal%20St.03m4a?raw=true',loaded);
  // songs[3] = loadSound('https://github.com/ZhijunSong/MuseumofSound/blob/main/assets/Canal%20street/Canal%20St.04.m4a?raw=true',loaded);
  // songs[4] = loadSound('assets/Canal street/CanalSt5.mp3',loaded);
  // img.push(createImg('https://raw.githubusercontent.com/ZhijunSong/MuseumofSound/main/assets/Canal%20street/CanalSt2.jpg','canalst'));
  // img.push(createImg('https://raw.githubusercontent.com/ZhijunSong/MuseumofSound/main/assets/Canal%20street/Canal%20St.%2001.png','canalst'));
  // img.push(createImg('https://raw.githubusercontent.com/ZhijunSong/MuseumofSound/main/assets/Canal%20street/CanalSt3.jpg','canalst'));
  // img.push(createImg('https://raw.githubusercontent.com/ZhijunSong/MuseumofSound/main/assets/Canal%20street/CanalSt4.jpg','canalst'));
  // img.push(createImg('https://github.com/ZhijunSong/MuseumofSound/blob/main/assets/Canal%20street/Canal%20St.%2005.HEIC?raw=true','canalst'));

  sound[5] = loadSound('assets/14th street/14thSt1.mp3',loaded);
  sound[6] = loadSound('assets/14th street/14thSt2.mp3',loaded);
  sound[7] = loadSound('assets/14th street/14thSt3.mp3',loaded);
  sound[8] = loadSound('assets/Ktown/34thSt1.mp3',loaded);
  sound[9] = loadSound('assets/Ktown/34thSt2.mp3',loaded);
  sound[10] = loadSound('assets/Time Square/42ndSt1.mp3',loaded);
  sound[11] = loadSound('assets/Time Square/42ndSt2.mp3',loaded);
  sound[12] = loadSound('assets/Time Square/42ndSt3.mp3',loaded);

  img.push(createImg("assets/Canalstreet/CanalSt1.jpg",'canalst'));
  img.push(createImg("assets/14th street/14thSt1.jpg",'canalst'));
  img.push(createImg("assets/Ktown/34thSt1.jpg",'canalst'));
  img.push(createImg("assets/Time Square/42ndSt1.jpg",'canalst'));
  img.push(createImg("assets/Time Square/42ndSt3.jpg",'canalst'));
}
function setup() {
  // cnv=createCanvas(0,0);
  // cnv.parent('#canvas');

  for(let i=0;i<sound.length;i++){
    buttons[i] = createButton(' ');
  }
  // buttons.forEach(button => {
  for(let i =0;i<buttons.length;i++){
    let d = i;
    buttons[i].mousePressed(function(){TogglePlay(i)});
    buttons[i].parent('loc');
    buttons[i].id('soundstop');
  }
  for(let i =0;i<img.length;i++){
    img[i].parent('background');
    img[i].id('backdrop')
  }  
  frameRate(30);

   
  c = createCanvas(windowWidth, windowHeight/5);
    noStroke();
    c.parent('#canvas');
    c.id('soundviz');
    rectMode(CENTER);
    colorMode(HSB);
  
    mic = new p5.AudioIn();
    mic.start();
  
    // load the sound, but don't play it yet
    soundFile = loadSound('assets/Canalstreet/CanalSt2.mp3')
  
    amplitude = new p5.Amplitude();
    amplitude.setInput(mic);
    amplitude.smooth(0.6);
    background(0,0);


}
function windowResized(){
  c.background(0);
  c = createCanvas(windowWidth, windowHeight/5);
  frameRate(30);

}
function draw(){
  // c.background(0,0);
  var level = amplitude.getLevel();
  c.background(0);

  // rectangle variables
  var spacing = 10;
  var w = width/ (prevLevels.length * spacing);

  var minHeight = 2;
  var roundness = 20;

  // add new level to end of array
  prevLevels.push(level);
  background(0,0);

  // remove first item in array
  prevLevels.splice(0, 1);

  // loop through all the previous levels
  for (var i = 0; i < prevLevels.length; i++) {

    var x = map(i, prevLevels.length, 0, width/2, width);
    var h = map(prevLevels[i], 0, 0.5, minHeight, height/6);

    var alphaValue = logMap(i, 0, prevLevels.length, 1, 250);

    var hueValue = map(h, minHeight, height/6, 200, 255);

    fill(hueValue, alphaValue);

    rect(x, height/2, w, h);
    rect(width/2-20 - x, height/2, w, h);
  }
}

function loaded(){
  console.log("loaded");
}

function TogglePlay(id){
    if(!sound[id].isPlaying()){
      sound[id].play(); 
      sound[id].setVolume(0.5);
      buttons[id].style('  transition: background-color 0.5s ease;');
    }else{
      sound[id].stop();
    }
    indexID= id;
    console.log(indexID);
 
    return indexID;
}



// console.log(location.description,stop);

var app2=new Vue({
  el:"#mapbox",
  data:{  
      counter:0,
      location:`${mapdata[0].features[0].location}`,
      description:`${mapdata[0].features[0].description}`,
      stopName:`${mapdata[0].stop}`

  },
  methods:{
    loadDatas(location){
      console.log(this.locations);
    },
    increment(){
      this.counter= indexID;
      this.location=`${mapdata[0].features[this.counter].location}`;
      this.description=`${mapdata[0].features[this.counter].description}`;
  }
}

})



